<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система назначения судей</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .upcoming {
            background-color: #fff3cd;
        }
        button {
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        button.view {
            background-color: #2196F3;
        }
        button.edit {
            background-color: #ffc107;
            color: #000;
        }
        button.delete {
            background-color: #f44336;
        }
        button.add {
            background-color: #ff9800;
            margin-bottom: 20px;
        }
        button.save {
            background-color: #4CAF50;
        }
        button.tab {
            background-color: #607d8b;
            margin-right: 5px;
            margin-bottom: 10px;
        }
        button.tab.active {
            background-color: #455a64;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .modal-body {
            overflow-y: auto;
            flex-grow: 1;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input, select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        .response-item {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        .response-yes {
            background-color: #d4edda;
        }
        .response-no {
            background-color: #f8d7da;
        }
        .judge-rating {
            font-weight: bold;
            color: #007bff;
        }
        .role-selector {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }
        .role-selector button {
            flex: 1;
        }
        .active-role {
            background-color: #2E7D32;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .action-buttons {
            display: flex;
            gap: 5px;
        }
    </style>
</head>
<body>
    <h1>Система назначения судей на матчи</h1>
    
    <div>
        <button class="tab active" onclick="openTab('matches')">Матчи</button>
        <button class="tab" onclick="openTab('judges')">Справочник судей</button>
        <button class="tab" onclick="openTab('secretaries')">Справочник секретарей</button>
    </div>
    
    <!-- Вкладка матчей -->
    <div id="matches" class="tab-content active">
        <h2>Все матчи</h2>
        <button class="add" onclick="openAddMatchModal()">Добавить матч</button>
        <table id="matchesTable">
            <thead>
                <tr>
                    <th>Дата</th>
                    <th>Лига</th>
                    <th>Команда 1</th>
                    <th>Команда 2</th>
                    <th>Место</th>
                    <th>Судья</th>
                    <th>Секретарь</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody>
                <!-- Матчи будут добавлены через JavaScript -->
            </tbody>
        </table>
        
        <h2>Ближайшие матчи (менее недели)</h2>
        <table id="upcomingTable">
            <thead>
                <tr>
                    <th>Дата</th>
                    <th>Лига</th>
                    <th>Команда 1</th>
                    <th>Команда 2</th>
                    <th>Место</th>
                    <th>Судья</th>
                    <th>Секретарь</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody>
                <!-- Ближайшие матчи будут добавлены через JavaScript -->
            </tbody>
        </table>
    </div>
    
    <!-- Вкладка справочника судей -->
    <div id="judges" class="tab-content">
        <h2>Справочник судей</h2>
        <button class="add" onclick="openAddJudgeModal()">Добавить судью</button>
        <table id="judgesTable">
            <thead>
                <tr>
                    <th>Фамилия</th>
                    <th>Рейтинг</th>
                    <th>Категория</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody>
                <!-- Судьи будут добавлены через JavaScript -->
            </tbody>
        </table>
    </div>
    
    <!-- Вкладка справочника секретарей -->
    <div id="secretaries" class="tab-content">
        <h2>Справочник секретарей</h2>
        <button class="add" onclick="openAddSecretaryModal()">Добавить секретаря</button>
        <table id="secretariesTable">
            <thead>
                <tr>
                    <th>Фамилия</th>
                    <th>Рейтинг</th>
                    <th>Категория</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody>
                <!-- Секретари будут добавлены через JavaScript -->
            </tbody>
        </table>
    </div>

    <!-- Модальные окна для матчей -->
    <div id="responseModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Ответ на матч</h2>
            <div class="role-selector">
                <button id="judgeRoleBtn" class="active-role" onclick="setResponseRole('judge')">Судья</button>
                <button id="secretaryRoleBtn" onclick="setResponseRole('secretary')">Секретарь</button>
            </div>
            <form id="responseForm">
                <input type="hidden" id="matchId">
                <input type="hidden" id="responseRole" value="judge">
                <div class="form-group">
                    <label for="judgeName">Ваша фамилия:</label>
                    <select id="judgeName" required>
                        <option value="">Выберите фамилию</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="availability">Можете участвовать?</label>
                    <select id="availability" required>
                        <option value="">Выберите вариант</option>
                        <option value="yes">Да, могу</option>
                        <option value="no">Нет, не могу</option>
                    </select>
                </div>
                <button type="submit" class="save">Отправить ответ</button>
            </form>
        </div>
    </div>

    <div id="viewResponsesModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Ответы на матч</h2>
            <div class="modal-body" id="responsesList"></div>
        </div>
    </div>

    <div id="addMatchModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Добавить новый матч</h2>
            <form id="addMatchForm">
                <div class="form-group">
                    <label for="newMatchDate">Дата:</label>
                    <input type="date" id="newMatchDate" required>
                </div>
                <div class="form-group">
                    <label for="newLeague">Лига:</label>
                    <input type="text" id="newLeague" list="leaguesList" required>
                    <datalist id="leaguesList">
                        <option value="Премьер Лига">
                        <option value="Первая Лига">
                        <option value="Вторая Лига">
                        <option value="Кубок Лиги">
                        <option value="Чемпионат Области">
                    </datalist>
                </div>
                <div class="form-group">
                    <label for="newTeam1">Команда 1:</label>
                    <input type="text" id="newTeam1" required>
                </div>
                <div class="form-group">
                    <label for="newTeam2">Команда 2:</label>
                    <input type="text" id="newTeam2" required>
                </div>
                <div class="form-group">
                    <label for="newLocation">Место проведения:</label>
                    <input type="text" id="newLocation" required>
                </div>
                <button type="submit" class="save">Добавить матч</button>
            </form>
        </div>
    </div>

    <div id="editMatchModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Редактировать матч</h2>
            <form id="editMatchForm">
                <input type="hidden" id="editMatchId">
                <div class="form-group">
                    <label for="editMatchDate">Дата:</label>
                    <input type="date" id="editMatchDate" required>
                </div>
                <div class="form-group">
                    <label for="editLeague">Лига:</label>
                    <input type="text" id="editLeague" list="leaguesList" required>
                </div>
                <div class="form-group">
                    <label for="editTeam1">Команда 1:</label>
                    <input type="text" id="editTeam1" required>
                </div>
                <div class="form-group">
                    <label for="editTeam2">Команда 2:</label>
                    <input type="text" id="editTeam2" required>
                </div>
                <div class="form-group">
                    <label for="editLocation">Место проведения:</label>
                    <input type="text" id="editLocation" required>
                </div>
                <button type="submit" class="save">Сохранить изменения</button>
            </form>
        </div>
    </div>

    <!-- Модальные окна для справочников -->
    <div id="addJudgeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Добавить судью</h2>
            <form id="addJudgeForm">
                <div class="form-group">
                    <label for="judgeName">Фамилия:</label>
                    <input type="text" id="judgeName" required>
                </div>
                <div class="form-group">
                    <label for="judgeRating">Рейтинг (1-5):</label>
                    <input type="number" id="judgeRating" min="1" max="5" step="0.1" required>
                </div>
                <div class="form-group">
                    <label for="judgeCategory">Категория:</label>
                    <select id="judgeCategory" required>
                        <option value="Национальная">Национальная</option>
                        <option value="Первая">Первая</option>
                        <option value="Вторая">Вторая</option>
                        <option value="Третья">Третья</option>
                    </select>
                </div>
                <button type="submit" class="save">Добавить</button>
            </form>
        </div>
    </div>

    <div id="editJudgeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Редактировать судью</h2>
            <form id="editJudgeForm">
                <input type="hidden" id="editJudgeId">
                <div class="form-group">
                    <label for="editJudgeName">Фамилия:</label>
                    <input type="text" id="editJudgeName" required>
                </div>
                <div class="form-group">
                    <label for="editJudgeRating">Рейтинг (1-5):</label>
                    <input type="number" id="editJudgeRating" min="1" max="5" step="0.1" required>
                </div>
                <div class="form-group">
                    <label for="editJudgeCategory">Категория:</label>
                    <select id="editJudgeCategory" required>
                        <option value="Национальная">Национальная</option>
                        <option value="Первая">Первая</option>
                        <option value="Вторая">Вторая</option>
                        <option value="Третья">Третья</option>
                    </select>
                </div>
                <button type="submit" class="save">Сохранить</button>
            </form>
        </div>
    </div>

    <div id="addSecretaryModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Добавить секретаря</h2>
            <form id="addSecretaryForm">
                <div class="form-group">
                    <label for="secretaryName">Фамилия:</label>
                    <input type="text" id="secretaryName" required>
                </div>
                <div class="form-group">
                    <label for="secretaryRating">Рейтинг (1-5):</label>
                    <input type="number" id="secretaryRating" min="1" max="5" step="0.1" required>
                </div>
                <div class="form-group">
                    <label for="secretaryCategory">Категория:</label>
                    <select id="secretaryCategory" required>
                        <option value="Высшая">Высшая</option>
                        <option value="Первая">Первая</option>
                        <option value="Вторая">Вторая</option>
                    </select>
                </div>
                <button type="submit" class="save">Добавить</button>
            </form>
        </div>
    </div>

    <div id="editSecretaryModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Редактировать секретаря</h2>
            <form id="editSecretaryForm">
                <input type="hidden" id="editSecretaryId">
                <div class="form-group">
                    <label for="editSecretaryName">Фамилия:</label>
                    <input type="text" id="editSecretaryName" required>
                </div>
                <div class="form-group">
                    <label for="editSecretaryRating">Рейтинг (1-5):</label>
                    <input type="number" id="editSecretaryRating" min="1" max="5" step="0.1" required>
                </div>
                <div class="form-group">
                    <label for="editSecretaryCategory">Категория:</label>
                    <select id="editSecretaryCategory" required>
                        <option value="Высшая">Высшая</option>
                        <option value="Первая">Первая</option>
                        <option value="Вторая">Вторая</option>
                    </select>
                </div>
                <button type="submit" class="save">Сохранить</button>
            </form>
        </div>
    </div>

    <script>
        // База данных матчей
        let matches = JSON.parse(localStorage.getItem('matches')) || [
            { id: 1, date: '2025-08-10', league: 'Премьер Лига', team1: 'Команда А', team2: 'Команда Б', location: 'Стадион 1', judge: '', secretary: '' },
            { id: 2, date: '2023-12-15', league: 'Первая Лига', team1: 'Команда В', team2: 'Команда Г', location: 'Стадион 2', judge: '', secretary: '' },
            { id: 3, date: '2023-12-17', league: 'Кубок Лиги', team1: 'Команда Д', team2: 'Команда Е', location: 'Стадион 3', judge: '', secretary: '' },
            { id: 4, date: '2023-12-20', league: 'Чемпионат Области', team1: 'Команда Ж', team2: 'Команда З', location: 'Стадион 1', judge: '', secretary: '' }
        ];

        // Справочник судей с рейтингом
        let judges = JSON.parse(localStorage.getItem('judges')) || [
            { id: 1, name: 'Иванов', rating: 5, category: 'Национальная' },
            { id: 2, name: 'Петров', rating: 4, category: 'Первая' },
            { id: 3, name: 'Сидоров', rating: 3, category: 'Вторая' },
            { id: 4, name: 'Кузнецов', rating: 4.5, category: 'Первая' }
        ];

        // Справочник секретарей
        let secretaries = JSON.parse(localStorage.getItem('secretaries')) || [
            { id: 1, name: 'Смирнова', rating: 4, category: 'Высшая' },
            { id: 2, name: 'Васильева', rating: 5, category: 'Высшая' },
            { id: 3, name: 'Попова', rating: 3.5, category: 'Первая' }
        ];

        // Загрузка ответов из localStorage
        let responses = JSON.parse(localStorage.getItem('judgeResponses')) || [];

        // Текущая активная вкладка
        let currentTab = 'matches';

        // Инициализация страницы
        document.addEventListener('DOMContentLoaded', function() {
            renderMatches();
            checkForUpcomingMatches();
            renderJudges();
            renderSecretaries();
            
            // Закрытие модальных окон при клике на крестик
            document.querySelectorAll('.close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            // Закрытие модальных окон при клике вне окна
            window.addEventListener('click', function(event) {
                if (event.target.className === 'modal') {
                    event.target.style.display = 'none';
                }
            });
        });

        // Переключение между вкладками
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`button[onclick="openTab('${tabName}')"]`).classList.add('active');
            currentTab = tabName;
        }

        // Установка роли для ответа (судья/секретарь)
        function setResponseRole(role) {
            document.getElementById('responseRole').value = role;
            document.getElementById('judgeRoleBtn').classList.remove('active-role');
            document.getElementById('secretaryRoleBtn').classList.remove('active-role');
            
            if (role === 'judge') {
                document.getElementById('judgeRoleBtn').classList.add('active-role');
                updateJudgeNamesDropdown();
            } else {
                document.getElementById('secretaryRoleBtn').classList.add('active-role');
                updateSecretaryNamesDropdown();
            }
        }

        // Обновление списка судей в выпадающем меню
        function updateJudgeNamesDropdown() {
            const select = document.getElementById('judgeName');
            select.innerHTML = '<option value="">Выберите фамилию</option>';
            judges.forEach(judge => {
                const option = document.createElement('option');
                option.value = judge.name;
                option.textContent = `${judge.name} (${judge.category}, рейтинг: ${judge.rating})`;
                select.appendChild(option);
            });
        }

        // Обновление списка секретарей в выпадающем меню
        function updateSecretaryNamesDropdown() {
            const select = document.getElementById('judgeName');
            select.innerHTML = '<option value="">Выберите фамилию</option>';
            secretaries.forEach(secretary => {
                const option = document.createElement('option');
                option.value = secretary.name;
                option.textContent = `${secretary.name} (${secretary.category}, рейтинг: ${secretary.rating})`;
                select.appendChild(option);
            });
        }

        // Отображение всех матчей
        function renderMatches() {
            const tableBody = document.querySelector('#matchesTable tbody');
            tableBody.innerHTML = '';
            
            matches.forEach(match => {
                const row = document.createElement('tr');
                if (isUpcomingMatch(match.date)) {
                    row.classList.add('upcoming');
                }
                
                // Находим все ответы для этого матча
                const matchResponses = responses.filter(r => r.matchId === match.id);
                
                // Назначаем судью и секретаря с наивысшим рейтингом из ответивших "да"
                assignOfficials(match, matchResponses);
                
                row.innerHTML = `
                    <td>${formatDate(match.date)}</td>
                    <td>${match.league}</td>
                    <td>${match.team1}</td>
                    <td>${match.team2}</td>
                    <td>${match.location}</td>
                    <td>${match.judge || 'Не назначен'}</td>
                    <td>${match.secretary || 'Не назначен'}</td>
                    <td class="action-buttons">
                        <button class="view" onclick="viewResponses(${match.id})">Ответы</button>
                        <button class="edit" onclick="openEditMatchModal(${match.id})">Изменить</button>
                        <button class="delete" onclick="deleteMatch(${match.id})">Удалить</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Сохраняем матчи в localStorage
            localStorage.setItem('matches', JSON.stringify(matches));
        }

        // Назначение судьи и секретаря на матч
        function assignOfficials(match, matchResponses) {
            // Назначение судьи
            const judgeResponses = matchResponses.filter(r => r.role === 'judge' && r.availability === 'yes');
            if (judgeResponses.length > 0) {
                const responsesWithRating = judgeResponses.map(response => {
                    const judge = judges.find(j => j.name === response.judgeName);
                    return {
                        ...response,
                        rating: judge ? judge.rating : 0,
                        category: judge ? judge.category : ''
                    };
                });
                
                // Сортируем по рейтингу (по убыванию) и категории
                responsesWithRating.sort((a, b) => {
                    if (b.rating !== a.rating) return b.rating - a.rating;
                    // Если рейтинги равны, сортируем по категории
                    const categoryOrder = ['Национальная', 'Первая', 'Вторая', 'Третья'];
                    return categoryOrder.indexOf(a.category) - categoryOrder.indexOf(b.category);
                });
                
                match.judge = responsesWithRating[0].judgeName;
            } else {
                match.judge = '';
            }
            
            // Назначение секретаря
            const secretaryResponses = matchResponses.filter(r => r.role === 'secretary' && r.availability === 'yes');
            if (secretaryResponses.length > 0) {
                const responsesWithRating = secretaryResponses.map(response => {
                    const secretary = secretaries.find(s => s.name === response.judgeName);
                    return {
                        ...response,
                        rating: secretary ? secretary.rating : 0,
                        category: secretary ? secretary.category : ''
                    };
                });
                
                // Сортируем по рейтингу (по убыванию) и категории
                responsesWithRating.sort((a, b) => {
                    if (b.rating !== a.rating) return b.rating - a.rating;
                    // Если рейтинги равны, сортируем по категории
                    const categoryOrder = ['Высшая', 'Первая', 'Вторая'];
                    return categoryOrder.indexOf(a.category) - categoryOrder.indexOf(b.category);
                });
                
                match.secretary = responsesWithRating[0].judgeName;
            } else {
                match.secretary = '';
            }
        }

        // Просмотр ответов на матч
        function viewResponses(matchId) {
            const modal = document.getElementById('viewResponsesModal');
            const responsesList = document.getElementById('responsesList');
            
            // Находим матч
            const match = matches.find(m => m.id === matchId);
            
            // Находим все ответы для этого матча
            const matchResponses = responses.filter(r => r.matchId === matchId);
            
            if (matchResponses.length === 0) {
                responsesList.innerHTML = '<p>Нет ответов на этот матч</p>';
            } else {
                responsesList.innerHTML = `
                    <h3>Матч: ${match.team1} vs ${match.team2}</h3>
                    <p>Дата: ${formatDate(match.date)}</p>
                    <p>Место: ${match.location}</p>
                    <p>Лига: ${match.league}</p>
                `;
                
                // Сортируем ответы по времени (новые сверху)
                matchResponses.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                // Группируем по ролям
                const judgeResponses = matchResponses.filter(r => r.role === 'judge');
                const secretaryResponses = matchResponses.filter(r => r.role === 'secretary');
                
                if (judgeResponses.length > 0) {
                    responsesList.innerHTML += '<h3>Судьи</h3>';
                    judgeResponses.forEach(response => {
                        addResponseToModal(response, judges, responsesList);
                    });
                }
                
                if (secretaryResponses.length > 0) {
                    responsesList.innerHTML += '<h3>Секретари</h3>';
                    secretaryResponses.forEach(response => {
                        addResponseToModal(response, secretaries, responsesList);
                    });
                }
            }
            
            modal.style.display = 'block';
        }

        // Добавление ответа в модальное окно просмотра
        function addResponseToModal(response, officialsList, container) {
            const responseItem = document.createElement('div');
            responseItem.className = `response-item ${response.availability === 'yes' ? 'response-yes' : 'response-no'}`;
            
            // Находим рейтинг
            const official = officialsList.find(j => j.name === response.judgeName);
            const rating = official ? official.rating : 'неизвестен';
            const category = official ? official.category : 'неизвестна';
            
            responseItem.innerHTML = `
                <p><strong>${response.role === 'judge' ? 'Судья' : 'Секретарь'}:</strong> ${response.judgeName}</p>
                <p><strong>Категория:</strong> ${category}</p>
                <p><strong>Рейтинг:</strong> ${rating}</p>
                <p><strong>Ответ:</strong> ${response.availability === 'yes' ? 'Может участвовать' : 'Не может участвовать'}</p>
                <p><strong>Время ответа:</strong> ${formatDateTime(response.timestamp)}</p>
            `;
            
            container.appendChild(responseItem);
        }

        // Проверка ближайших матчей (менее недели)
        function checkForUpcomingMatches() {
            const upcomingTableBody = document.querySelector('#upcomingTable tbody');
            upcomingTableBody.innerHTML = '';
            
            const upcomingMatches = matches.filter(match => isUpcomingMatch(match.date));
            
            if (upcomingMatches.length === 0) {
                upcomingTableBody.innerHTML = '<tr><td colspan="8">Нет ближайших матчей</td></tr>';
                return;
            }
            
            upcomingMatches.forEach(match => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(match.date)}</td>
                    <td>${match.league}</td>
                    <td>${match.team1}</td>
                    <td>${match.team2}</td>
                    <td>${match.location}</td>
                    <td>${match.judge || 'Не назначен'}</td>
                    <td>${match.secretary || 'Не назначен'}</td>
                    <td class="action-buttons">
                        <button onclick="openResponseModal(${match.id})">Ответить</button>
                        <button class="view" onclick="viewResponses(${match.id})">Ответы</button>
                    </td>
                `;
                upcomingTableBody.appendChild(row);
            });
        }

        // Проверка, является ли матч ближайшим (менее недели)
        function isUpcomingMatch(matchDate) {
            const today = new Date();
            const match = new Date(matchDate);
            const diffTime = match - today;
            const diffDays = diffTime / (1000 * 60 * 60 * 24);
            
            return diffDays <= 7 && diffDays >= 0;
        }

        // Открытие модального окна для ответа
        function openResponseModal(matchId) {
            const modal = document.getElementById('responseModal');
            document.getElementById('matchId').value = matchId;
            document.getElementById('responseRole').value = 'judge';
            document.getElementById('judgeRoleBtn').classList.add('active-role');
            document.getElementById('secretaryRoleBtn').classList.remove('active-role');
            updateJudgeNamesDropdown();
            modal.style.display = 'block';
        }

        // Открытие модального окна для добавления матча
        function openAddMatchModal() {
            const modal = document.getElementById('addMatchModal');
            document.getElementById('addMatchForm').reset();
            modal.style.display = 'block';
        }

        // Открытие модального окна для редактирования матча
        function openEditMatchModal(matchId) {
            const match = matches.find(m => m.id === matchId);
            if (!match) return;
            
            document.getElementById('editMatchId').value = match.id;
            document.getElementById('editMatchDate').value = match.date;
            document.getElementById('editLeague').value = match.league;
            document.getElementById('editTeam1').value = match.team1;
            document.getElementById('editTeam2').value = match.team2;
            document.getElementById('editLocation').value = match.location;
            
            const modal = document.getElementById('editMatchModal');
            modal.style.display = 'block';
        }

        // Удаление матча
        function deleteMatch(matchId) {
            if (confirm('Вы уверены, что хотите удалить этот матч?')) {
                matches = matches.filter(m => m.id !== matchId);
                responses = responses.filter(r => r.matchId !== matchId);
                
                localStorage.setItem('matches', JSON.stringify(matches));
                localStorage.setItem('judgeResponses', JSON.stringify(responses));
                
                renderMatches();
                checkForUpcomingMatches();
            }
        }

        // Открытие модального окна для добавления судьи
        function openAddJudgeModal() {
            const modal = document.getElementById('addJudgeModal');
            document.getElementById('addJudgeForm').reset();
            modal.style.display = 'block';
        }

        // Открытие модального окна для редактирования судьи
        function openEditJudgeModal(judgeId) {
            const judge = judges.find(j => j.id === judgeId);
            if (!judge) return;
            
            document.getElementById('editJudgeId').value = judge.id;
            document.getElementById('editJudgeName').value = judge.name;
            document.getElementById('editJudgeRating').value = judge.rating;
            document.getElementById('editJudgeCategory').value = judge.category;
            
            const modal = document.getElementById('editJudgeModal');
            modal.style.display = 'block';
        }

        // Удаление судьи
        function deleteJudge(judgeId) {
            if (confirm('Вы уверены, что хотите удалить этого судью?')) {
                judges = judges.filter(j => j.id !== judgeId);
                localStorage.setItem('judges', JSON.stringify(judges));
                renderJudges();
            }
        }

        // Открытие модального окна для добавления секретаря
        function openAddSecretaryModal() {
            const modal = document.getElementById('addSecretaryModal');
            document.getElementById('addSecretaryForm').reset();
            modal.style.display = 'block';
        }

        // Открытие модального окна для редактирования секретаря
        function openEditSecretaryModal(secretaryId) {
            const secretary = secretaries.find(s => s.id === secretaryId);
            if (!secretary) return;
            
            document.getElementById('editSecretaryId').value = secretary.id;
            document.getElementById('editSecretaryName').value = secretary.name;
            document.getElementById('editSecretaryRating').value = secretary.rating;
            document.getElementById('editSecretaryCategory').value = secretary.category;
            
            const modal = document.getElementById('editSecretaryModal');
            modal.style.display = 'block';
        }

        // Удаление секретаря
        function deleteSecretary(secretaryId) {
            if (confirm('Вы уверены, что хотите удалить этого секретаря?')) {
                secretaries = secretaries.filter(s => s.id !== secretaryId);
                localStorage.setItem('secretaries', JSON.stringify(secretaries));
                renderSecretaries();
            }
        }

        // Отображение списка судей
        function renderJudges() {
            const tableBody = document.querySelector('#judgesTable tbody');
            tableBody.innerHTML = '';
            
            judges.forEach(judge => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${judge.name}</td>
                    <td>${judge.rating}</td>
                    <td>${judge.category}</td>
                    <td class="action-buttons">
                        <button class="edit" onclick="openEditJudgeModal(${judge.id})">Изменить</button>
                        <button class="delete" onclick="deleteJudge(${judge.id})">Удалить</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            localStorage.setItem('judges', JSON.stringify(judges));
        }

        // Отображение списка секретарей
        function renderSecretaries() {
            const tableBody = document.querySelector('#secretariesTable tbody');
            tableBody.innerHTML = '';
            
            secretaries.forEach(secretary => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${secretary.name}</td>
                    <td>${secretary.rating}</td>
                    <td>${secretary.category}</td>
                    <td class="action-buttons">
                        <button class="edit" onclick="openEditSecretaryModal(${secretary.id})">Изменить</button>
                        <button class="delete" onclick="deleteSecretary(${secretary.id})">Удалить</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            localStorage.setItem('secretaries', JSON.stringify(secretaries));
        }

        // Обработка отправки формы ответа
        document.getElementById('responseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const matchId = parseInt(document.getElementById('matchId').value);
            const judgeName = document.getElementById('judgeName').value.split(' (')[0]; // Удаляем доп. информацию
            const availability = document.getElementById('availability').value;
            const role = document.getElementById('responseRole').value;
            
            // Проверяем, есть ли уже ответ от этого человека на эту роль в этом матче
            const existingResponseIndex = responses.findIndex(
                r => r.matchId === matchId && r.judgeName === judgeName && r.role === role
            );
            
            // Если ответ уже есть, обновляем его, иначе добавляем новый
            if (existingResponseIndex !== -1) {
                responses[existingResponseIndex] = {
                    matchId,
                    judgeName,
                    availability,
                    role,
                    timestamp: new Date().toISOString()
                };
            } else {
                responses.push({
                    matchId,
                    judgeName,
                    availability,
                    role,
                    timestamp: new Date().toISOString()
                });
            }
            
            // Сохраняем ответы в localStorage
            localStorage.setItem('judgeResponses', JSON.stringify(responses));
            
            // Закрываем модальное окно
            document.getElementById('responseModal').style.display = 'none';
            
            // Очищаем форму
            this.reset();
            
            // Обновляем таблицы с учетом нового ответа
            renderMatches();
            checkForUpcomingMatches();
            
            alert('Ваш ответ сохранен!');
        });

        // Обработка добавления нового матча
        document.getElementById('addMatchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newMatch = {
                id: matches.length > 0 ? Math.max(...matches.map(m => m.id)) + 1 : 1,
                date: document.getElementById('newMatchDate').value,
                league: document.getElementById('newLeague').value,
                team1: document.getElementById('newTeam1').value,
                team2: document.getElementById('newTeam2').value,
                location: document.getElementById('newLocation').value,
                judge: '',
                secretary: ''
            };
            
            matches.push(newMatch);
            
            // Сохраняем матчи в localStorage
            localStorage.setItem('matches', JSON.stringify(matches));
            
            // Закрываем модальное окно
            document.getElementById('addMatchModal').style.display = 'none';
            
            // Очищаем форму
            this.reset();
            
            // Обновляем таблицы
            renderMatches();
            checkForUpcomingMatches();
            
            alert('Матч добавлен!');
        });

        // Обработка редактирования матча
        document.getElementById('editMatchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const matchId = parseInt(document.getElementById('editMatchId').value);
            const matchIndex = matches.findIndex(m => m.id === matchId);
            
            if (matchIndex !== -1) {
                matches[matchIndex] = {
                    ...matches[matchIndex],
                    date: document.getElementById('editMatchDate').value,
                    league: document.getElementById('editLeague').value,
                    team1: document.getElementById('editTeam1').value,
                    team2: document.getElementById('editTeam2').value,
                    location: document.getElementById('editLocation').value
                };
                
                // Сохраняем матчи в localStorage
                localStorage.setItem('matches', JSON.stringify(matches));
                
                // Закрываем модальное окно
                document.getElementById('editMatchModal').style.display = 'none';
                
                // Обновляем таблицы
                renderMatches();
                checkForUpcomingMatches();
                
                alert('Изменения сохранены!');
            }
        });

        // Обработка добавления судьи
        document.getElementById('addJudgeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newJudge = {
                id: judges.length > 0 ? Math.max(...judges.map(j => j.id)) + 1 : 1,
                name: document.getElementById('judgeName').value,
                rating: parseFloat(document.getElementById('judgeRating').value),
                category: document.getElementById('judgeCategory').value
            };
            
            judges.push(newJudge);
            
            // Сохраняем судей в localStorage
            localStorage.setItem('judges', JSON.stringify(judges));
            
            // Закрываем модальное окно
            document.getElementById('addJudgeModal').style.display = 'none';
            
            // Очищаем форму
            this.reset();
            
            // Обновляем таблицу
            renderJudges();
            
            alert('Судья добавлен!');
        });

        // Обработка редактирования судьи
        document.getElementById('editJudgeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const judgeId = parseInt(document.getElementById('editJudgeId').value);
            const judgeIndex = judges.findIndex(j => j.id === judgeId);
            
            if (judgeIndex !== -1) {
                judges[judgeIndex] = {
                    id: judgeId,
                    name: document.getElementById('editJudgeName').value,
                    rating: parseFloat(document.getElementById('editJudgeRating').value),
                    category: document.getElementById('editJudgeCategory').value
                };
                
                // Сохраняем судей в localStorage
                localStorage.setItem('judges', JSON.stringify(judges));
                
                // Закрываем модальное окно
                document.getElementById('editJudgeModal').style.display = 'none';
                
                // Обновляем таблицу
                renderJudges();
                
                alert('Изменения сохранены!');
            }
        });

        // Обработка добавления секретаря
        document.getElementById('addSecretaryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newSecretary = {
                id: secretaries.length > 0 ? Math.max(...secretaries.map(s => s.id)) + 1 : 1,
                name: document.getElementById('secretaryName').value,
                rating: parseFloat(document.getElementById('secretaryRating').value),
                category: document.getElementById('secretaryCategory').value
            };
            
            secretaries.push(newSecretary);
            
            // Сохраняем секретарей в localStorage
            localStorage.setItem('secretaries', JSON.stringify(secretaries));
            
            // Закрываем модальное окно
            document.getElementById('addSecretaryModal').style.display = 'none';
            
            // Очищаем форму
            this.reset();
            
            // Обновляем таблицу
            renderSecretaries();
            
            alert('Секретарь добавлен!');
        });

        // Обработка редактирования секретаря
        document.getElementById('editSecretaryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const secretaryId = parseInt(document.getElementById('editSecretaryId').value);
            const secretaryIndex = secretaries.findIndex(s => s.id === secretaryId);
            
            if (secretaryIndex !== -1) {
                secretaries[secretaryIndex] = {
                    id: secretaryId,
                    name: document.getElementById('editSecretaryName').value,
                    rating: parseFloat(document.getElementById('editSecretaryRating').value),
                    category: document.getElementById('editSecretaryCategory').value
                };
                
                // Сохраняем секретарей в localStorage
                localStorage.setItem('secretaries', JSON.stringify(secretaries));
                
                // Закрываем модальное окно
                document.getElementById('editSecretaryModal').style.display = 'none';
                
                // Обновляем таблицу
                renderSecretaries();
                
                alert('Изменения сохранены!');
            }
        });

        // Форматирование даты
        function formatDate(dateString) {
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('ru-RU', options);
        }
        
        // Форматирование даты и времени
        function formatDateTime(dateTimeString) {
            const options = { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            return new Date(dateTimeString).toLocaleDateString('ru-RU', options);
        }
    </script>
</body>
</html>